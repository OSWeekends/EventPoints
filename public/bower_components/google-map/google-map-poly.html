<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../google-apis/google-maps-api.html">
<link rel="import" href="google-map-point.html">



</head><body><dom-module id="google-map-poly">
  <style>
    :host {
      display: none;
    }
  </style>
  <template>
    <content id="points" select="google-map-point"></content>
  </template>
</dom-module>

<script>!function(){Polymer({is:"google-map-poly",properties:{poly:{type:Object,readOnly:!0},path:{type:Object,readOnly:!0},map:{type:Object,observer:"_mapChanged"},clickable:{type:Boolean,value:!1,observer:"_clickableChanged"},clickEvents:{type:Boolean,value:!1,observer:"_clickEventsChanged"},closed:{type:Boolean,value:!1,observer:"_closedChanged"},draggable:{type:Boolean,value:!1},dragEvents:{type:Boolean,value:!1,observer:"_dragEventsChanged"},editable:{type:Boolean,value:!1,observer:"_editableChanged"},editing:{type:Boolean,value:!1,notify:!0,readOnly:!0},fillColor:{type:String,value:"",observer:"_fillColorChanged"},fillOpacity:{type:Number,value:0,observer:"_fillOpacityChanged"},geodesic:{type:Boolean,value:!1,observer:"_geodesicChanged"},icons:{type:Array,value:null,observer:"_iconsChanged"},mouseEvents:{type:Boolean,value:!1,observer:"_mouseEventsChanged"},strokeColor:{type:String,value:"black",observer:"_strokeColorChanged"},strokeOpacity:{type:Number,value:1,observer:"_strokeOpacityChanged"},strokePosition:{type:String,value:"center",observer:"_strokePositionChanged"},strokeWeight:{type:Number,value:3,observer:"_strokeWeightChanged"},zIndex:{type:Number,value:0,observer:"_zIndexChanged"}},detached:function(){this.poly.setMap(null),this._pointsObserver&&(this._pointsObserver.disconnect(),this._pointsObserver=null);for(var e in this._listeners)this._clearListener(e)},attached:function(){this.poly&&this.poly.setMap(this.map)},attributeChanged:function(e){if(this.poly)switch(e){case"hidden":this.poly.setVisible(!this.hidden);break;case"draggable":this.poly.setDraggable(this.draggable)}},_clickableChanged:function(){this.poly&&this.poly.set("clickable",this.clickable)},_clickEventsChanged:function(){this.poly&&(this.clickEvents?(this._forwardEvent("click"),this._forwardEvent("dblclick"),this._forwardEvent("rightclick")):(this._clearListener("click"),this._clearListener("dblclick"),this._clearListener("rightclick")))},_closedChanged:function(){this._mapChanged()},_dragEventsChanged:function(){this.poly&&(this.clickEvents?(this._forwardEvent("drag"),this._forwardEvent("dragend"),this._forwardEvent("dragstart")):(this._clearListener("drag"),this._clearListener("dragend"),this._clearListener("dragstart")))},_editableChanged:function(){this.poly&&this.poly.setEditable(this.editable)},_fillColorChanged:function(){this.poly&&this.poly.set("fillColor",this.fillColor)},_fillOpacityChanged:function(){this.poly&&this.poly.set("fillOpacity",this.fillOpacity)},_geodesicChanged:function(){this.poly&&this.poly.set("geodesic",this.geodesic)},_iconsChanged:function(){this.poly&&this.poly.set("icons",this.icons)},_mapChanged:function(){this.poly&&(this.poly.setMap(null),google.maps.event.clearInstanceListeners(this.poly)),this.map&&this.map instanceof google.maps.Map&&this._createPoly()},_mouseEventsChanged:function(){this.poly&&(this.mouseEvents?(this._forwardEvent("mousedown"),this._forwardEvent("mousemove"),this._forwardEvent("mouseout"),this._forwardEvent("mouseover"),this._forwardEvent("mouseup")):(this._clearListener("mousedown"),this._clearListener("mousemove"),this._clearListener("mouseout"),this._clearListener("mouseover"),this._clearListener("mouseup")))},_strokeColorChanged:function(){this.poly&&this.poly.set("strokeColor",this.strokeColor)},_strokeOpacityChanged:function(){this.poly&&this.poly.set("strokeOpacity",this.strokeOpacity)},_strokePositionChanged:function(){this.poly&&this.poly.set("strokePosition",this._convertStrokePosition())},_strokeWeightChanged:function(){this.poly&&this.poly.set("strokeWeight",this.strokeWeight)},_zIndexChanged:function(){this.poly&&this.poly.set("zIndex",this.zIndex)},_buildPathFromPoints:function(){this._points=Array.prototype.slice.call(Polymer.dom(this.$.points).getDistributedNodes()),this._building=!0,this.path.clear();for(var e,t=0;e=this._points[t];++t)this.path.push(e.getPosition());this._building=!1,this.fire("google-map-poly-path-built",this.path),this._pointsObserver||(this._pointsObserver=new MutationObserver(this._buildPathFromPoints.bind(this)),this._pointsObserver.observe(this,{childList:!0}))},_clearListener:function(e){this._listeners[e]&&(google.maps.event.removeListener(this._listeners[e]),this._listeners[e]=null)},_convertStrokePosition:function(){return google.maps.StrokePosition&&this.strokePosition?google.maps.StrokePosition[this.strokePosition.toUpperCase()]:0},_createPoly:function(){this.path||(this._setPath(new google.maps.MVCArray),google.maps.event.addListener(this.path,"insert_at",this._startEditing.bind(this)),google.maps.event.addListener(this.path,"set_at",this._updatePoint.bind(this)),this._buildPathFromPoints());var e={clickable:this.clickable||this.draggable,draggable:this.draggable,editable:this.editable,geodesic:this.geodesic,map:this.map,path:this.path,strokeColor:this.strokeColor,strokeOpacity:this.strokeOpacity,strokePosition:this._convertStrokePosition(),strokeWeight:this.strokeWeight,visible:!this.hidden,zIndex:this.zIndex};this.closed?(e.fillColor=this.fillColor,e.fillOpacity=this.fillOpacity,this._setPoly(new google.maps.Polygon(e))):(e.icons=this.icons,this._setPoly(new google.maps.Polyline(e))),this._listeners={},this._clickEventsChanged(),this._mouseEventsChanged(),this._dragEventsChanged()},_forwardEvent:function(e){this._listeners[e]=google.maps.event.addListener(this.poly,e,function(t){this.fire("google-map-poly-"+e,t)}.bind(this))},_startEditing:function(e){this._building||this.editing||(this._setEditing(!0),this._points=null,google.maps.event.addListenerOnce(this.map,"click",function(){this._setEditing(!1),this.fire("google-map-poly-path-updated",this.path)}.bind(this)))},_updatePoint:function(e,t){this._points&&(this._points[e].latitude=t.lat(),this._points[e].longitude=t.lng())}})}();</script>
</body></html>